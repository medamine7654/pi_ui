{% extends 'front/base.html.twig' %}

{% block title %}Mes Reservations - RentAll{% endblock %}

{% block body %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-8">Mes reservations</h1>

    {% for message in app.flashes('success') %}
        <div class="mb-4 rounded-md border border-green-200 bg-green-50 px-4 py-3 text-sm text-green-700">{{ message }}</div>
    {% endfor %}
    {% for message in app.flashes('error') %}
        <div class="mb-4 rounded-md border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700">{{ message }}</div>
    {% endfor %}

    <div class="mb-6 border-b border-gray-200">
        <nav class="-mb-px flex space-x-8">
            <a href="{{ path('app_reservations') }}" class="{% if status == 'all' %}border-blue-600 text-blue-600{% else %}border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300{% endif %} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Toutes</a>
            <a href="{{ path('app_reservations', {status: 'confirmed'}) }}" class="{% if status == 'confirmed' %}border-blue-600 text-blue-600{% else %}border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300{% endif %} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Confirmees</a>
            <a href="{{ path('app_reservations', {status: 'cancelled'}) }}" class="{% if status == 'cancelled' %}border-blue-600 text-blue-600{% else %}border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300{% endif %} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Annulees</a>
        </nav>
    </div>

    {% if reservations|length > 0 %}
        <div class="space-y-4">
            {% for reservation in reservations %}
                {% set isService = reservation.type == 'service' %}
                {% set item = isService ? reservation.service : reservation.materiel %}
                <div class="rounded-lg border border-gray-200 bg-white shadow-sm">
                    <div class="p-6">
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex-1">
                                <p class="text-xs text-gray-500 uppercase tracking-wide">{{ isService ? 'Service' : 'Materiel' }}</p>
                                <h3 class="text-lg font-semibold text-gray-900">{{ isService ? (item ? item.titre : 'Service supprime') : (item ? item.nom : 'Materiel supprime') }}</h3>
                                <p class="text-sm text-gray-500 mt-1">Debut: {{ reservation.startDate ? reservation.startDate|date('d/m/Y H:i') : '-' }}</p>
                                <p class="text-sm text-gray-500">Fin: {{ reservation.endDate ? reservation.endDate|date('d/m/Y H:i') : '-' }}</p>
                                <p class="text-sm text-gray-500">Prix total: {{ reservation.totalPrice }}</p>
                            </div>
                            <div class="text-right">
                                <span class="inline-flex px-2 py-1 rounded-full text-xs font-medium {{ reservation.status == 'confirmed' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700' }}">
                                    {{ reservation.status == 'confirmed' ? 'Confirmee' : 'Annulee' }}
                                </span>
                                {% if reservation.status == 'confirmed' %}
                                    <form method="post" action="{{ path('app_reservation_cancel', {id: reservation.id}) }}" class="mt-3" onsubmit="return confirm('Annuler cette reservation ?');">
                                        <input type="hidden" name="_token" value="{{ csrf_token('cancel-reservation' ~ reservation.id) }}">
                                        <button class="text-sm font-medium text-red-600 hover:text-red-700">
                                            Annuler {{ isService ? 'le service' : 'le materiel' }}
                                        </button>
                                    </form>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="rounded-lg border border-gray-200 bg-white p-8 text-center text-gray-600">
            Aucune reservation pour ce filtre.
        </div>
    {% endif %}
</div>
{% endblock %}
