{% extends 'admin/base.html.twig' %}

{% block title %}Tableau de bord - RentAdmin{% endblock %}

{% block body %}
<!-- Page Header -->
<div class="mb-6">
    <h1 class="text-2xl font-bold text-dark font-heading">Tableau de bord</h1>
    <p class="text-gray-500 mt-1">Vue d'ensemble de la plateforme</p>
</div>

<!-- Stats Grid -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4 mb-6">
    {% set stats = [
        { title: 'Utilisateurs totaux', value: stats.totalUsers|default(2847), description: (stats.totalHosts|default(456)) ~ ' hôtes, ' ~ (stats.totalGuests|default(2391)) ~ ' voyageurs', icon: 'fa-users', trend: 'up', trendValue: '+12% ce mois', color: 'primary' },
        { title: 'Services actifs', value: stats.totalServices|default(1234), icon: 'fa-briefcase', trend: 'up', trendValue: '+8% ce mois', color: 'secondary' },
        { title: 'Matériel disponible', value: stats.totalTools|default(892), icon: 'fa-wrench', color: 'dark' },
        { title: 'Réservations', value: stats.totalBookings|default(5678), description: (stats.totalToolRentals|default(3421)) ~ ' locations de matériel', icon: 'fa-calendar', trend: 'up', trendValue: '+15% ce mois', color: 'primary' },
        { title: 'Revenus mensuels', value: stats.monthlyRevenue|default(45680) ~ '€', icon: 'fa-euro-sign', trend: 'up', trendValue: '+5.2% ce mois', color: 'secondary' },
        { title: 'Signalements', value: stats.pendingReports|default(23), description: (stats.flaggedAccounts|default(12)) ~ ' comptes signalés', icon: 'fa-flag', trend: 'down', trendValue: '-3 ce mois', color: 'primary' },
    ] %}
    
    {% for stat in stats %}
        <div class="bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition-all duration-300 hover:-translate-y-0.5 relative overflow-hidden group">
            <div class="absolute top-0 right-0 w-24 h-24 opacity-10 rounded-bl-full transition-transform group-hover:scale-110 bg-{{ stat.color }}"></div>
            <div class="flex items-center justify-between mb-2">
                <span class="text-sm text-gray-500">{{ stat.title }}</span>
                <div class="p-2 rounded-lg bg-{{ stat.color }}/10">
                    <i class="fas {{ stat.icon }} text-{{ stat.color }}"></i>
                </div>
            </div>
            <div class="text-2xl font-bold text-dark counter" data-target="{{ stat.value|replace({'€': '', ',': ''}) }}">{{ stat.value }}</div>
            {% if stat.description is defined %}
                <p class="text-xs text-gray-500 mt-1">{{ stat.description }}</p>
            {% endif %}
            {% if stat.trend is defined %}
                <div class="flex items-center gap-1 mt-2 text-xs {% if stat.trend == 'up' %}text-green-600{% else %}text-red-600{% endif %}">
                    <i class="fas fa-arrow-{{ stat.trend }}"></i>
                    <span>{{ stat.trendValue }}</span>
                </div>
            {% endif %}
        </div>
    {% endfor %}
</div>

<!-- Charts Row -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <!-- Revenue Chart -->
    <div class="bg-white rounded-xl shadow-sm p-6">
        <h3 class="text-lg font-semibold text-dark mb-4">Évolution des revenus</h3>
        <div class="h-48 flex items-end justify-between gap-2">
            {% set revenue_data = [
                { label: 'Juil', value: 42000 },
                { label: 'Août', value: 45000 },
                { label: 'Sep', value: 48000 },
                { label: 'Oct', value: 52000 },
                { label: 'Nov', value: 55000 },
                { label: 'Déc', value: 45680 },
            ] %}
            {% set max_revenue = 60000 %}
            {% for item in revenue_data %}
                <div class="flex-1 flex flex-col items-center gap-2">
                    <div class="w-full relative">
                        <div class="w-full rounded-t-md bg-secondary transition-all duration-500 hover:opacity-80" 
                             style="height: {{ (item.value / max_revenue) * 160 }}px; opacity: {{ 0.8 + (loop.index / revenue_data|length) * 0.2 }}"></div>
                        <div class="absolute -top-5 left-1/2 -translate-x-1/2 text-xs font-medium">{{ (item.value / 1000)|round }}k</div>
                    </div>
                    <span class="text-xs text-gray-500">{{ item.label }}</span>
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- Bookings Chart -->
    <div class="bg-white rounded-xl shadow-sm p-6">
        <h3 class="text-lg font-semibold text-dark mb-4">Réservations et locations</h3>
        <div class="space-y-4">
            <div>
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm text-gray-600">Réservations</span>
                    <span class="text-sm font-medium text-secondary">468</span>
                </div>
                <svg viewBox="0 0 100 50" class="w-full h-24" preserveAspectRatio="none">
                    <defs>
                        <linearGradient id="gradient-secondary" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" stop-color="#00A699" stop-opacity="0.3" />
                            <stop offset="100%" stop-color="#00A699" stop-opacity="0" />
                        </linearGradient>
                    </defs>
                    <polygon points="0,50 0,35 20,30 40,25 60,20 80,15 100,10 100,50" fill="url(#gradient-secondary)" />
                    <polyline points="0,35 20,30 40,25 60,20 80,15 100,10" fill="none" stroke="#00A699" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
            <div>
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm text-gray-600">Locations</span>
                    <span class="text-sm font-medium text-primary">285</span>
                </div>
                <svg viewBox="0 0 100 50" class="w-full h-24" preserveAspectRatio="none">
                    <defs>
                        <linearGradient id="gradient-primary" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" stop-color="#FF5A5F" stop-opacity="0.3" />
                            <stop offset="100%" stop-color="#FF5A5F" stop-opacity="0" />
                        </linearGradient>
                    </defs>
                    <polygon points="0,50 0,40 20,38 40,35 60,30 80,25 100,20 100,50" fill="url(#gradient-primary)" />
                    <polyline points="0,40 20,38 40,35 60,30 80,25 100,20" fill="none" stroke="#FF5A5F" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>
        <div class="flex items-center justify-center gap-6 mt-4">
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded-full bg-secondary"></div>
                <span class="text-sm text-gray-600">Services</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded-full bg-primary"></div>
                <span class="text-sm text-gray-600">Matériel</span>
            </div>
        </div>
    </div>
</div>

<!-- Bottom Row -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Platform Health -->
    <div class="bg-white rounded-xl shadow-sm p-6">
        <h3 class="text-lg font-semibold text-dark mb-4">Santé de la plateforme</h3>
        <div class="space-y-4">
            <div>
                <div class="flex justify-between text-sm mb-1">
                    <span class="text-gray-600">Taux d'annulation</span>
                    <span class="font-medium">{{ stats.cancellationRate|default(4.2) }}%</span>
                </div>
                <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                    <div class="h-full bg-primary rounded-full transition-all duration-500" style="width: {{ stats.cancellationRate|default(4.2) * 10 }}%"></div>
                </div>
                <p class="text-xs text-gray-500 mt-1">Seuil recommandé: &lt;5%</p>
            </div>
            <div>
                <div class="flex justify-between text-sm mb-1">
                    <span class="text-gray-600">Satisfaction clients</span>
                    <span class="font-medium">4.6/5</span>
                </div>
                <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                    <div class="h-full bg-secondary rounded-full transition-all duration-500" style="width: 92%"></div>
                </div>
            </div>
            <div>
                <div class="flex justify-between text-sm mb-1">
                    <span class="text-gray-600">Hôtes actifs</span>
                    <span class="font-medium">87%</span>
                </div>
                <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                    <div class="h-full bg-dark rounded-full transition-all duration-500" style="width: 87%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="bg-white rounded-xl shadow-sm p-6 lg:col-span-2">
        <h3 class="text-lg font-semibold text-dark mb-4">Activité récente</h3>
        <div class="space-y-1 max-h-64 overflow-y-auto custom-scrollbar">
            {% set activities = [
                { type: 'report_submitted', description: 'Nouveau signalement sur "Visite guidée du Louvre"', userName: 'Jean Martin', timestamp: '2024-01-20T10:30:00', color: 'primary', icon: 'fa-flag' },
                { type: 'booking_cancelled', description: 'Réservation annulée par Sophie Bernard', userName: 'Sophie Bernard', timestamp: '2024-01-20T09:15:00', color: 'primary', icon: 'fa-calendar-times' },
                { type: 'user_registered', description: 'Nouvel utilisateur inscrit', userName: 'Camille Leroy', timestamp: '2024-01-20T08:45:00', color: 'secondary', icon: 'fa-user-plus' },
                { type: 'service_created', description: 'Nouveau service en attente de validation', userName: 'Thomas Moreau', timestamp: '2024-01-19T16:20:00', color: 'secondary', icon: 'fa-briefcase' },
                { type: 'user_suspended', description: 'Compte suspendu pour activité suspecte', userName: 'Sophie Bernard', timestamp: '2024-01-19T14:00:00', color: 'primary', icon: 'fa-ban' },
            ] %}
            
            {% for activity in activities %}
                <div class="flex items-start gap-3 p-3 rounded-lg hover:bg-gray-50 transition-colors">
                    <div class="p-2 rounded-full flex-shrink-0 bg-{{ activity.color }}/10">
                        <i class="fas {{ activity.icon }} text-{{ activity.color }}"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm text-dark">{{ activity.description }}</p>
                        {% if activity.userName %}
                            <p class="text-xs text-gray-500 mt-0.5">par {{ activity.userName }}</p>
                        {% endif %}
                        <p class="text-xs text-gray-400 mt-1">{{ activity.timestamp|date('d M, H:i') }}</p>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

