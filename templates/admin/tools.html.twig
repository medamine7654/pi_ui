{% extends 'admin/base.html.twig' %}

{% block title %}Materiel - Admin{% endblock %}
{% block search_placeholder %}Rechercher un materiel...{% endblock %}

{% block body %}
<div class="mb-6 flex items-center justify-between">
    <div>
        <h1 class="text-2xl font-bold text-dark font-heading">Materiel</h1>
        <p class="text-gray-500 mt-1">Liste, recherche, tri, export, edition et suppression.</p>
    </div>
    <div class="flex items-center gap-2">
        <a href="{{ path('admin_tools_stats') }}" class="px-3 py-2 rounded-lg border border-gray-200 bg-white text-sm hover:bg-gray-50">Statistiques</a>
        <a href="{{ path('admin_tools_export', {search: filters.search, status: filters.status, sort: filters.sort}) }}" class="px-3 py-2 rounded-lg bg-secondary text-white text-sm hover:opacity-90">Exporter CSV</a>
    </div>
</div>

{% for message in app.flashes('success') %}
    <div class="mb-3 rounded-lg border border-green-200 bg-green-50 px-4 py-2 text-sm text-green-700">{{ message }}</div>
{% endfor %}
{% for message in app.flashes('error') %}
    <div class="mb-3 rounded-lg border border-red-200 bg-red-50 px-4 py-2 text-sm text-red-700">{{ message }}</div>
{% endfor %}

<div class="grid grid-cols-1 sm:grid-cols-4 gap-4 mb-6">
    <div class="bg-white rounded-xl p-4 shadow-sm"><p class="text-sm text-gray-500">Total</p><p class="text-2xl font-bold">{{ stats.total }}</p></div>
    <div class="bg-white rounded-xl p-4 shadow-sm"><p class="text-sm text-gray-500">Disponibles</p><p class="text-2xl font-bold">{{ stats.available }}</p></div>
    <div class="bg-white rounded-xl p-4 shadow-sm"><p class="text-sm text-gray-500">Indisponibles</p><p class="text-2xl font-bold">{{ stats.unavailable }}</p></div>
    <div class="bg-white rounded-xl p-4 shadow-sm"><p class="text-sm text-gray-500">Etat renseigne</p><p class="text-2xl font-bold">{{ stats.withEtat }}</p></div>
</div>

<div class="bg-white rounded-xl shadow-sm p-4 mb-4">
    <form method="get" class="flex flex-col md:flex-row gap-3">
        <input type="text" name="search" value="{{ filters.search }}" placeholder="Nom, etat..." class="flex-1 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm">
        <select name="status" class="bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm">
            <option value="">Tous</option>
            <option value="available" {% if filters.status == 'available' %}selected{% endif %}>Disponible</option>
            <option value="unavailable" {% if filters.status == 'unavailable' %}selected{% endif %}>Indisponible</option>
        </select>
        <select name="sort" class="bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm">
            <option value="newest" {% if filters.sort == 'newest' %}selected{% endif %}>Plus recent</option>
            <option value="oldest" {% if filters.sort == 'oldest' %}selected{% endif %}>Plus ancien</option>
            <option value="name_asc" {% if filters.sort == 'name_asc' %}selected{% endif %}>Nom A-Z</option>
            <option value="name_desc" {% if filters.sort == 'name_desc' %}selected{% endif %}>Nom Z-A</option>
            <option value="etat" {% if filters.sort == 'etat' %}selected{% endif %}>Etat</option>
            <option value="available_first" {% if filters.sort == 'available_first' %}selected{% endif %}>Disponibles d'abord</option>
        </select>
        <button class="px-4 py-2 rounded-lg bg-primary text-white text-sm">Filtrer</button>
    </form>
</div>

<div class="bg-white rounded-xl shadow-sm overflow-x-auto">
    <table class="w-full">
        <thead class="bg-gray-50 border-b border-gray-200">
            <tr>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nom</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Etat</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Disponibilite</th>
                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
        {% for tool in tools %}
            <tr class="hover:bg-gray-50">
                <td class="px-4 py-3 text-sm">{{ tool.id }}</td>
                <td class="px-4 py-3 text-sm font-medium">{{ tool.nom }}</td>
                <td class="px-4 py-3 text-sm">{{ tool.etat ?: '-' }}</td>
                <td class="px-4 py-3 text-sm">
                    <span class="px-2 py-1 rounded-full text-xs {{ tool.disponible ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700' }}">
                        {{ tool.disponible ? 'Disponible' : 'Indisponible' }}
                    </span>
                </td>
                <td class="px-4 py-3">
                    <div class="flex justify-end items-center gap-2">
                        <a href="{{ path('admin_tool_edit', {id: tool.id}) }}" class="px-2 py-1 text-xs rounded border border-gray-200 hover:bg-gray-50">Modifier</a>
                        <form method="post" action="{{ path('admin_tool_delete', {id: tool.id}) }}" onsubmit="return confirm('Supprimer ce materiel ?');">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete-tool' ~ tool.id) }}">
                            <button class="px-2 py-1 text-xs rounded bg-red-600 text-white hover:bg-red-700">Supprimer</button>
                        </form>
                    </div>
                </td>
            </tr>
        {% else %}
            <tr><td colspan="5" class="px-4 py-8 text-center text-gray-500">Aucun materiel.</td></tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
