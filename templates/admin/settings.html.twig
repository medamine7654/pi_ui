{% extends 'base.html.twig' %}

{% block title %}Paramètres - RentAdmin{% endblock %}

{% block body %}
<!-- Page Header -->
<div class="mb-6">
    <h1 class="text-2xl font-bold text-dark font-heading">Paramètres</h1>
    <p class="text-gray-500 mt-1">Gérer vos préférences et la configuration</p>
</div>

<!-- Tabs -->
<div class="mb-6">
    <div class="border-b border-gray-200">
        <nav class="flex gap-6" id="settings-tabs">
            <button onclick="showTab('profile')" class="pb-3 text-sm font-medium text-primary border-b-2 border-primary" data-tab="profile">
                Profil
            </button>
            <button onclick="showTab('notifications')" class="pb-3 text-sm font-medium text-gray-500 hover:text-dark" data-tab="notifications">
                Notifications
            </button>
            <button onclick="showTab('security')" class="pb-3 text-sm font-medium text-gray-500 hover:text-dark" data-tab="security">
                Sécurité
            </button>
            <button onclick="showTab('platform')" class="pb-3 text-sm font-medium text-gray-500 hover:text-dark" data-tab="platform">
                Plateforme
            </button>
        </nav>
    </div>
</div>

<!-- Profile Tab -->
<div id="tab-profile" class="tab-content">
    <div class="bg-white rounded-xl shadow-sm p-6">
        <h3 class="text-lg font-semibold text-dark mb-1">Informations personnelles</h3>
        <p class="text-sm text-gray-500 mb-6">Mettez à jour vos informations de profil</p>
        
        <form method="post" action="{{ path('admin_settings_profile') }}">
            <input type="hidden" name="_token" value="{{ csrf_token('settings-profile') }}">
            
            <!-- Avatar -->
            <div class="flex items-center gap-4 mb-6">
                <img src="{{ app.user.avatar|default('https://i.pravatar.cc/150?u=admin') }}" alt="Profile" class="w-20 h-20 rounded-full">
                <div>
                    <button type="button" class="px-4 py-2 border border-gray-200 rounded-lg text-sm hover:bg-gray-50">
                        Changer la photo
                    </button>
                    <p class="text-xs text-gray-500 mt-1">JPG, PNG. Max 2MB</p>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Prénom</label>
                    <input type="text" name="firstName" value="{{ app.user.firstName|default('Admin') }}" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Nom</label>
                    <input type="text" name="lastName" value="{{ app.user.lastName|default('RentAdmin') }}" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" name="email" value="{{ app.user.email|default('admin@rentadmin.com') }}" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Téléphone</label>
                    <input type="tel" name="phone" value="{{ app.user.phone|default('+33 6 12 34 56 78') }}" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary">
                </div>
            </div>
            
            <div class="flex justify-end">
                <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg text-sm hover:bg-primary/90 transition-colors">
                    <i class="fas fa-save mr-2"></i>Enregistrer
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Notifications Tab -->
<div id="tab-notifications" class="tab-content hidden">
    <div class="bg-white rounded-xl shadow-sm p-6">
        <h3 class="text-lg font-semibold text-dark mb-1">Préférences de notification</h3>
        <p class="text-sm text-gray-500 mb-6">Choisissez comment vous souhaitez être notifié</p>
        
        <form method="post" action="{{ path('admin_settings_notifications') }}">
            <input type="hidden" name="_token" value="{{ csrf_token('settings-notifications') }}">
            
            <div class="space-y-4 mb-6">
                {% set notifications = [
                    { id: 'email', icon: 'fa-envelope', title: 'Notifications par email', description: 'Recevoir des emails pour les événements importants', checked: true },
                    { id: 'push', icon: 'fa-mobile-alt', title: 'Notifications push', description: 'Notifications en temps réel sur votre appareil', checked: false },
                    { id: 'reports', icon: 'fa-bell', title: 'Nouveaux signalements', description: 'Être alerté des nouveaux signalements', checked: true },
                    { id: 'fraud', icon: 'fa-shield-alt', title: 'Alertes de fraude', description: 'Notifications pour les activités suspectes', checked: true },
                    { id: 'bookings', icon: 'fa-bell', title: 'Nouvelles réservations', description: 'Être notifié des nouvelles réservations', checked: false },
                ] %}
                
                {% for notification in notifications %}
                    <div class="flex items-center justify-between py-3 {% if not loop.last %}border-b border-gray-100{% endif %}">
                        <div class="flex items-center gap-3">
                            <i class="fas {{ notification.icon }} text-gray-400 w-5"></i>
                            <div>
                                <p class="font-medium text-sm">{{ notification.title }}</p>
                                <p class="text-sm text-gray-500">{{ notification.description }}</p>
                            </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" name="notifications[{{ notification.id }}]" class="sr-only peer" {% if notification.checked %}checked{% endif %}>
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                        </label>
                    </div>
                {% endfor %}
            </div>
            
            <div class="flex justify-end">
                <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg text-sm hover:bg-primary/90 transition-colors">
                    <i class="fas fa-save mr-2"></i>Enregistrer
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Security Tab -->
<div id="tab-security" class="tab-content hidden">
    <div class="bg-white rounded-xl shadow-sm p-6">
        <h3 class="text-lg font-semibold text-dark mb-1">Sécurité du compte</h3>
        <p class="text-sm text-gray-500 mb-6">Protégez votre compte administrateur</p>
        
        <!-- Change Password -->
        <div class="mb-6">
            <h4 class="font-medium mb-4">Changer le mot de passe</h4>
            <form method="post" action="{{ path('admin_settings_password') }}" class="space-y-4">
                <input type="hidden" name="_token" value="{{ csrf_token('settings-password') }}">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Mot de passe actuel</label>
                    <input type="password" name="currentPassword" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Nouveau mot de passe</label>
                    <input type="password" name="newPassword" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Confirmer le mot de passe</label>
                    <input type="password" name="confirmPassword" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary">
                </div>
                <button type="submit" class="px-4 py-2 border border-gray-200 rounded-lg text-sm hover:bg-gray-50">
                    Mettre à jour le mot de passe
                </button>
            </form>
        </div>
        
        <hr class="border-gray-200 mb-6">
        
        <!-- Security Options -->
        <form method="post" action="{{ path('admin_settings_security') }}">
            <input type="hidden" name="_token" value="{{ csrf_token('settings-security') }}">
            
            <div class="space-y-4 mb-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-lock text-gray-400 w-5"></i>
                        <div>
                            <p class="font-medium text-sm">Authentification à deux facteurs</p>
                            <p class="text-sm text-gray-500">Sécurisez votre compte avec 2FA</p>
                        </div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" name="twoFactor" class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                    </label>
                </div>
                
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-bell text-gray-400 w-5"></i>
                        <div>
                            <p class="font-medium text-sm">Alertes de connexion</p>
                            <p class="text-sm text-gray-500">Être notifié des nouvelles connexions</p>
                        </div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" name="loginAlerts" class="sr-only peer" checked>
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                    </label>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Délai d'expiration de session (minutes)</label>
                    <input type="number" name="sessionTimeout" value="30" class="w-32 bg-gray-50 border border-gray-200 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary">
                </div>
            </div>
            
            <div class="flex justify-end">
                <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg text-sm hover:bg-primary/90 transition-colors">
                    <i class="fas fa-save mr-2"></i>Enregistrer
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Platform Tab -->
<div id="tab-platform" class="tab-content hidden">
    <div class="bg-white rounded-xl shadow-sm p-6">
        <h3 class="text-lg font-semibold text-dark mb-1">Configuration de la plateforme</h3>
        <p class="text-sm text-gray-500 mb-6">Paramètres globaux de l'application</p>
        
        <form method="post" action="{{ path('admin_settings_platform') }}">
            <input type="hidden" name="_token" value="{{ csrf_token('settings-platform') }}">
            
            <!-- Fraud Detection Thresholds -->
            <div class="mb-6">
                <h4 class="font-medium mb-4 flex items-center gap-2">
                    <i class="fas fa-shield-alt"></i>
                    Seuils de détection de fraude
                </h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Taux d'annulation (%)</label>
                        <input type="number" name="cancellationThreshold" value="10" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary">
                        <p class="text-xs text-gray-500 mt-1">Alerte si dépassé</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Note minimale</label>
                        <input type="number" name="reviewThreshold" value="3.5" step="0.1" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary">
                        <p class="text-xs text-gray-500 mt-1">Alerte si en dessous</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Annonces par jour</label>
                        <input type="number" name="listingThreshold" value="5" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary">
                        <p class="text-xs text-gray-500 mt-1">Alerte si dépassé</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Signalements</label>
                        <input type="number" name="reportThreshold" value="3" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary">
                        <p class="text-xs text-gray-500 mt-1">Suspension automatique</p>
                    </div>
                </div>
            </div>
            
            <hr class="border-gray-200 mb-6">
            
            <!-- Platform Settings -->
            <div class="mb-6">
                <h4 class="font-medium mb-4 flex items-center gap-2">
                    <i class="fas fa-globe"></i>
                    Paramètres généraux
                </h4>
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-medium text-sm">Mode maintenance</p>
                            <p class="text-sm text-gray-500">Rendre la plateforme inaccessible</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" name="maintenanceMode" class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                        </label>
                    </div>
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-medium text-sm">Inscriptions ouvertes</p>
                            <p class="text-sm text-gray-500">Permettre aux nouveaux utilisateurs de s'inscrire</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" name="registrationOpen" class="sr-only peer" checked>
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                        </label>
                    </div>
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-medium text-sm">Validation automatique</p>
                            <p class="text-sm text-gray-500">Approuver automatiquement les nouveaux services</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" name="autoApprove" class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-end">
                <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg text-sm hover:bg-primary/90 transition-colors">
                    <i class="fas fa-save mr-2"></i>Enregistrer
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block javascripts %}
<script>
function showTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden');
    });
    
    // Show selected tab
    document.getElementById('tab-' + tabName).classList.remove('hidden');
    
    // Update tab buttons
    document.querySelectorAll('#settings-tabs button').forEach(btn => {
        btn.classList.remove('text-primary', 'border-b-2', 'border-primary');
        btn.classList.add('text-gray-500');
    });
    
    event.target.classList.remove('text-gray-500');
    event.target.classList.add('text-primary', 'border-b-2', 'border-primary');
}
</script>
{% endblock %}
